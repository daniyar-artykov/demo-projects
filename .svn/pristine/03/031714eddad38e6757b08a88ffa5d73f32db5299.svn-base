/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * Frame.java
 *
 * Created on Jun 2, 2009, 3:47:03 PM
 */

package sleekbill.systray;

import java.awt.AlphaComposite;
import java.awt.Color;
import java.awt.Composite;
import java.awt.GradientPaint;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.Paint;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.geom.RoundRectangle2D;
import java.util.ArrayList;

import javax.swing.ImageIcon;
import javax.swing.JFrame;
import javax.swing.event.HyperlinkEvent;
import javax.swing.event.HyperlinkListener;

import sleekbill.Common;
import sleekbill.utils.SBDesktop;

/**
 *
 * @author flaviu marcu
 */
public class JFSysTray extends javax.swing.JFrame {

    Color startGradient = new Color(249, 250, 252);
    Color endGradient = new Color(239, 246, 254);

    /** Creates new form Frame */
    public JFSysTray(String text, int d, boolean areFirmaConfigurata) {
        initComponents();
        jEPText.setText(text);
        jBComanda.setIcon(new ImageIcon("./images/buttons/lock.png"));
        jBStart.setIcon(new ImageIcon("./images/buttons/systray_ico_sleek_bill.png"));
        jBExit.setIcon(new ImageIcon("./images/buttons/Exit.png"));
        if (areFirmaConfigurata) {
            jLIconLeft.setIcon(new ImageIcon("./images/icons/systray_img_config.png"));
        } else {
            jLIconLeft.setIcon(new ImageIcon("./images/icons/systray_img_lock.png"));
        }
//        jBStart.setEnabled(d<31);
        jBStart.addActionListener(new ActionListener() {

            @Override
            public void actionPerformed(ActionEvent e) {
                setVisible(false);
                if(Common.getMainFrame()!=null && Common.getMainFrame().isShowing()) Common.getMainFrame().toFront();
                else JFSysTray.startSleekBill();
            }
        });
        setTitle("Sleek Bill");
        setDefaultCloseOperation(JFrame.HIDE_ON_CLOSE);
        ArrayList<Image> imageList = new ArrayList<Image>();
        imageList.add(new ImageIcon("./images/icons/icon.png").getImage());
        imageList.add(new ImageIcon("./images/icons/icon_mic.gif").getImage());
        setIconImages(imageList);
        jEPText.addHyperlinkListener(new HyperlinkListener() {

            @Override
            public void hyperlinkUpdate(HyperlinkEvent e) {
                try {
                    if (e.getEventType().equals(HyperlinkEvent.EventType.ACTIVATED) && e.getURL()!=null) {
                        if (java.awt.Desktop.isDesktopSupported()) {
//                            java.awt.Desktop.getDesktop().browse(e.getURL().toURI());
							SBDesktop.browse(e.getURL().toURI());
                        }
                    }
                } catch (Exception ex) {
                    ex.printStackTrace();
                }
            }
        });
        setLocationRelativeTo(null);
    }

    public static void startSleekBill(){
        new Thread(new Runnable() {

            @Override
            public void run() {
                sleekbill.Main.main(new String[]{"ok"});
            }
        }).start();
    }
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jPMain = new javax.swing.JPanel();
        jLIconRight = new javax.swing.JLabel();
        jEPText = new JPGradientVertical(startGradient, endGradient);
        jPanel1 = new javax.swing.JPanel();
        jBComanda = new javax.swing.JButton();
        jBStart = new javax.swing.JButton();
        jBExit = new javax.swing.JButton();
        jLIconLeft = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        getContentPane().setLayout(new javax.swing.BoxLayout(getContentPane(), javax.swing.BoxLayout.LINE_AXIS));

        jPMain.setOpaque(false);
        jPMain.setPreferredSize(new java.awt.Dimension(625, 210));
        jPMain.setLayout(new java.awt.GridBagLayout());

        jLIconRight.setIcon(new ImageIcon("./images/dialogs/systray_info_ico.png"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.SOUTHEAST;
        gridBagConstraints.weightx = 0.01;
        gridBagConstraints.weighty = 0.01;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 3, 15);
        jPMain.add(jLIconRight, gridBagConstraints);

        jEPText.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        jEPText.setContentType("text/html"); // NOI18N
        jEPText.setEditable(false);
        jEPText.setMinimumSize(new java.awt.Dimension(300, 70));
        jEPText.setOpaque(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.01;
        gridBagConstraints.weighty = 0.01;
        gridBagConstraints.insets = new java.awt.Insets(10, 0, 0, 10);
        jPMain.add(jEPText, gridBagConstraints);

        jPanel1.setOpaque(false);

        jBComanda.setText("Order");
        jBComanda.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBComandaActionPerformed(evt);
            }
        });
        jPanel1.add(jBComanda);

        jBStart.setText("Start Sleek Bill");
        jPanel1.add(jBStart);

        jBExit.setText("Exit");
        jBExit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBExitActionPerformed(evt);
            }
        });
        jPanel1.add(jBExit);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 0.01;
        gridBagConstraints.insets = new java.awt.Insets(8, 0, 8, 0);
        jPMain.add(jPanel1, gridBagConstraints);

        jLIconLeft.setIcon(new ImageIcon("./images/dialogs/icon_exclamare.png"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.insets = new java.awt.Insets(0, 7, 0, 7);
        jPMain.add(jLIconLeft, gridBagConstraints);

        getContentPane().add(jPMain);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jBExitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBExitActionPerformed
        System.exit(1);
    }//GEN-LAST:event_jBExitActionPerformed

    private void jBComandaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBComandaActionPerformed
        Common.comandaCod(null, null);
    }//GEN-LAST:event_jBComandaActionPerformed

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new JFSysTray("test",2,true).setVisible(true);
            }
        });
    }

    class JPGradientVertical extends javax.swing.JEditorPane {

        Color startGradient = new Color(255, 255, 255);
        Color endGradient = new Color(0, 0, 0);
        int addX = 0;
        int addY = 0;
        int addW = 0;
        int addH = 0;

        public JPGradientVertical(Color startGradient, Color endGradient) {
            this.startGradient = startGradient;
            this.endGradient = endGradient;
            this.addX = 2;
            this.addY = 2;
            this.addW = -4;
            this.addH = -4;
        }

        public JPGradientVertical(Color startGradient, Color endGradient, int addX, int addY, int addW, int addH) {
            this.startGradient = startGradient;
            this.endGradient = endGradient;
            this.addX = addX;
            this.addY = addY;
            this.addW = addW;
            this.addH = addH;
        }

        @Override
        public void paintComponent(Graphics g) {
            super.paintComponent(g);
            float alpha = 0.6f;
            Graphics2D g2 = (Graphics2D) g;
            Paint oldPaint = g2.getPaint();
            Composite oldComposite = g2.getComposite();
            GradientPaint paint = new GradientPaint(0, 0, startGradient, 0, getHeight(), endGradient);
            AlphaComposite newComposite = AlphaComposite.getInstance(AlphaComposite.SRC_OVER, alpha);
            g2.setComposite(newComposite);
            g2.setPaint(paint);
            g2.fill(new RoundRectangle2D.Double(0 + addX, 0 + addY, getWidth() + addW, getHeight() + addH, 0, 0));
            g2.setPaint(oldPaint);
            g2.setComposite(oldComposite);
            super.paintComponent(g2);
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jBComanda;
    private javax.swing.JButton jBExit;
    private javax.swing.JButton jBStart;
    private javax.swing.JEditorPane jEPText;
    private javax.swing.JLabel jLIconLeft;
    private javax.swing.JLabel jLIconRight;
    private javax.swing.JPanel jPMain;
    private javax.swing.JPanel jPanel1;
    // End of variables declaration//GEN-END:variables

}
