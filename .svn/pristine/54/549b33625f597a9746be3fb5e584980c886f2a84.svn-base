package sleekbill.frames;

import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.Insets;
import java.awt.Rectangle;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Vector;

import javax.swing.JButton;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.SwingUtilities;
import javax.swing.border.LineBorder;

import sleekbill.Common;
import sleekbill.Company;
import sleekbill.swingutils.JPanelFirma;
import sleekbill.util.SBSwingUtils;

/**
 *
 * @author  Andrei
 */
public class JDialogSwitchCompany extends javax.swing.JDialog {
	Vector<Company> companies = Common.companies;
	JPanelFirma fa = null;
	Company selectedCompany = null;

    public JDialogSwitchCompany(java.awt.Frame parent, boolean forceSelect) {
        super(parent, true);
        initComponents();
        refresh();
        setTitle("Switch Current Company");
        setLocationRelativeTo(parent);
        //setResizable(false);
        pack();

        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
				if (fa != null) {
					fa.scrollRectToVisible(new Rectangle(0, -20, 1, 150));
					fa.getButton().requestFocus();
				} else {
					jPMain.scrollRectToVisible(new Rectangle(0, 0, 1, 1));
				}
			}
        });
        
        SBSwingUtils.addContextMenuToChildren(this);
    }

    public void refresh(){
        //companies =  Company.getCompaniesList();
        int row=0;
        fa  = null;
        for(Company f:companies){
            GridBagConstraints gbc = new GridBagConstraints();
            gbc.gridx = 0;
            gbc.gridy = row;
            gbc.anchor = GridBagConstraints.NORTH;
            gbc.fill = GridBagConstraints.HORIZONTAL;
            gbc.insets = new Insets(10, 10, 10, 10);
            gbc.weightx = 0.01;
            //gbc.weighty = ;
            row++;
            JPanelFirma jpf = new JPanelFirma(f, al);
            jpf.jBSelect.setName("bSelect" + row);
            jpf.setBorder(new LineBorder(new java.awt.Color(195, 210, 219), 1, true));
            jPFirme.add(jpf,gbc);
            //jPFirme.add(Box.createRigidArea(new Dimension(30, 30)));
            if(f.isActive()){
            	fa = jpf;
            	selectedCompany = f;
            }
        }
        JPanel main = (JPanel) getContentPane();
        final JScrollPane mainJsp = new JScrollPane(main);
        mainJsp.getVerticalScrollBar().setUnitIncrement(30);
        mainJsp.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED);
        mainJsp.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
        setContentPane(mainJsp);
        setMinimumSize(new Dimension(500,400));
        if(companies.size()<4)
            setPreferredSize(new Dimension(500,500));
        else
            setPreferredSize(new Dimension(500,700));
        pack();
    }
    
    ActionListener al = new ActionListener() {
        @Override
        public void actionPerformed(ActionEvent e) {
            JPanelFirma jpf = (JPanelFirma)((JButton)e.getSource()).getParent();
            selectedCompany = jpf.getFirma();
//            final Company f = jpf.getFirma();
//            setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));
//            Common.switchToFirma(f.getName());
//
//            SwingUtilities.invokeLater(new Runnable() {
//                @Override
//                public void run() {
//                    Messages.showOkMessage(JDialogSwitchCompany.this, f.getName() +" is currently selected", "Select company");
//                }
//            });
            dispose();            
        }
    };
    
	public Vector<Company> getCompanies() {
		return companies;
	}

	public Company getSelectedCompany() {
		return selectedCompany;
	}
	
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jPMain = new javax.swing.JPanel();
        jPFirme = new javax.swing.JPanel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setResizable(false);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                formWindowClosing(evt);
            }
        });
        getContentPane().setLayout(new java.awt.GridBagLayout());

        jPMain.setBackground(new java.awt.Color(229, 235, 242));
        jPMain.setLayout(new java.awt.GridBagLayout());

        jPFirme.setBackground(new java.awt.Color(229, 235, 242));
        jPFirme.setMaximumSize(new java.awt.Dimension(800, 600));
        jPFirme.setLayout(new java.awt.GridBagLayout());
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTH;
        gridBagConstraints.weightx = 0.5;
        gridBagConstraints.weighty = 0.5;
        jPMain.add(jPFirme, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 0.1;
        gridBagConstraints.weighty = 0.1;
        getContentPane().add(jPMain, gridBagConstraints);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
        if(Common.getSelectedCompany().getName().equals("")){
//            Common.getMainFrame().dispatchEvent(new WindowEvent(Common.getMainFrame(), WindowEvent.WINDOW_CLOSING));
        	System.exit(0);
        }
        else{
            dispose();
        }
    }//GEN-LAST:event_formWindowClosing

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                JDialogSwitchCompany dialog = new JDialogSwitchCompany(null, true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel jPFirme;
    private javax.swing.JPanel jPMain;
    // End of variables declaration//GEN-END:variables



}
